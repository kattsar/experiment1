BEGIN EXPERIMENT
from datetime import date

# Get the participant number from the experiment info dialog
participant_number = expInfo['participant']

# Get the current date
current_date = date.today().strftime("%Y-%m-%d")

# Define a placeholder filename
filename = ""

# Define and initialise trialN
trialN = 0

BEGIN ROUTINE
import sounddevice as sd
import soundfile as sf
import os

output_dir = "D:/GitHub/experiment1/data"  # Set the desired directory to save the audio files

# Increment trialN for each new routine
trialN += 1

# Define the filename based on participant number and date
filename = f"response_p{participant_number}_{current_date}_trial{str(trialN)}.wav"

def save_audio(response):
    sf.write(os.path.join(output_dir, filename), response, samplerate)

# Set the sampling rate of the microphone response component
samplerate = int(sd.query_devices(None, 'input')['default_samplerate'])

# Set the callback function to save audio during the experiment
def audio_callback(indata, frames, time, status):
    if status:
        print(status)
    save_audio(indata)

# Initialize the microphone and start recording
mic = sd.InputStream(callback=audio_callback, channels=1, samplerate=samplerate)
mic.start()

END ROUTINE
# Stop recording when the routine ends
mic.stop()
mic.close()






Yes, you can keep the Microphone component and add a piece of code to save the audio files as the experiment progresses. Here's how you can do it:

Insert a code component in your PsychoPy experiment by clicking on "Add Component" and selecting "Code" from the dropdown menu.

In the "Begin Experiment" tab of the code component, add the following code to initialize a sound object and a file to save the audio:

python
Copy code
from psychopy import sound

# Set the audio file name and format
audio_filename = 'audio.wav'
audio_format = 'wav'

# Initialize the sound object
audio = sound.Sound(backend='ptb', stereo=True)
In the "Each Frame" tab of the code component, add the following code to continuously update the audio recording:
python
Copy code
if microphone.status == NOT_STARTED:
    microphone.status = STARTED
    microphone.tStart = t
    microphone.frameNStart = frameN
    microphone.record(sec=-1, block=False)

elif microphone.status == STARTED and t - microphone.tStart >= 0.5:
    microphone.stop()
    audio.append(microphone.getSnapshot())
    audio.save(filename=audio_filename, format=audio_format)
This code checks if the Microphone component has started recording (microphone.status == NOT_STARTED). If it has not started, it starts recording audio. If it has started and at least 0.5 seconds have passed (t - microphone.tStart >= 0.5), it stops the recording, appends the recorded audio to the audio object, and saves it to the specified file.

Make sure you have correctly set up the Microphone component in your experiment. Set the "Start" field to a keyboard or other event that initiates the recording. Set the "Stop" field to a keyboard or event that stops the recording.
With these code components in place, the Microphone component will start recording when triggered, and every 0.5 seconds it will save the recorded audio to the specified file. You can adjust the file name and format according to your preferences.

Remember to check the documentation of PsychoPy for more information on the Microphone component and the sound.Sound() class for advanced audio settings and options.








